@{
    Layout = "_Layout";
    ViewBag.Title = "Contacts";
}

<style>
    a {
        color: #fff;
    }
</style>

<div class="container">
    <div style="display: none" class="alert alert-danger" id="error-alert" role="alert"></div>
    <table class="table table-striped" id="contacts-table">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Name</th>
                <th scope="col">Phone</th>
                <th scope="col">Handle</th>
            </tr>
        </thead>
        <tbody>

        </tbody>
    </table>
</div>



@section Scripts {
    <script>

        $.ajax({
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            type: 'GET',
            url: "http://localhost:5002/api/contacts/",

            success: function (response) {
                displayContacts(JSON.stringify(response));
            },

            error: function (error) {
                displayError(error.responseText);
            },
        });

        function displayContacts(response) {
            const data = JSON.parse(response);

            data.forEach((contact, index) => {
                const row = `<tr>
                              <th scope="row">${index + 1}</th>
                              <td>${contact.name}</td>
                              <td>+${contact.phone}</td>
                              <td>
                                   <button type="button" class="btn btn-primary">
                                        <a href="/contacts/update/${contact.id}">Edit</a>
                                   </button>
                                   <button type="button" class="btn btn-danger">
                                        <a href="/contacts/update/${contact.id}">Delete</a>
                                   </button>
                              </td>
                           </tr>`;
                $("#contacts-table").append(row);
            }); 
        }

        function displayError(error) {
            let errorAlert = $("#error-alert")
            errorAlert.text(error);
            errorAlert.fadeIn(100);
        }
    </script>
}